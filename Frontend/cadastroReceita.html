<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Receita</title>
    <link rel="stylesheet" href="CSS/stylesCadastroReceita.css">
</head>
<body>
   <header>
       <div class="logo">
            <img src="IMG/chefs-delight-restaurant-logo_11024933.png!sw800" alt="">
       </div>
       <div class="titulos">
            <div  class="titulo">
                <p>QUASETUDO</p>
            </div>
            <div class="titulo2">
                <p>
                    GOSTOSO
                </p>
            </div>
       </div>
       <div class="icone-usuario">
           <a href="perfil.html"><img src="IMG/4092564-about-mobile-ui-profile-ui-user-website_114033.png" alt=""></a>
       </div>
   </header>
    <main>

        <div class="nav">
            <ul>
                 <li>
                    <a href="index.php">Home</a>
                </li>

                <li>
                    <a href="listarReceitas.html">Todas as Receitas</a>
                </li>
                <li>
                    <a href="cadastroReceita.html">Nova Receita</a>
                </li>
                <li>
                    <a href="listarReceitas.html">Suas Receitas</a>
                </li>
               
                <li>
                    <a href="refeicao.html">Refeição</a>
                </li>
                
                </li>
                <li>
                    <a href="usuarios.html">Chefs</a>
                </li>
                <li>
                    <a href="sobre.html">Sobre</a>
                </li>
            </ul>
        </div>


            <div class="cadastrarReceita">
                <h3>Cadastrar Receita</h2>
            </div>
        <div class="container">
           <form id="formReceita">
                <div class="divBackground" >
                    <label>Título da Receita:</label>
                    <input type="text" id="titulo" required>
                </div>
                <div class="divBackground">
                    <div>
                        <label>Descrição da Receita:</label>
                    </div>
                    <div>
                        <textarea name="" id="descricao"></textarea>
                    </div>
                </div>
                <div class="divBackground">
                    <label for="">Dificuldade</label>
                    <select name="" id="seleDificuldade"></select>
                </div>
                <div class="divBackground">
                    <label for="">Custo</label>
                    <select name="" id="seleCusto"></select>
                </div>
                <div class="divBackground">
                    <label for="">Categoria</label>
                    <select name="" id="seleCategoria"></select>
                </div>
                <div class="divBackground">
                    <label for="">Cozinha</label>
                    <select name="" id="seleCozinha"></select>
                </div>

             
                <div class="botoes">
                    <div>
                        <input type="text" id="novoIngrediente" placeholder="Novo ingrediente">
                        <button class="btnAdicionar" type="button" onclick="addIngrediente()">Adicionar Ingrediente</button>
                    </div>
                    <div>
                        <input type="text" id="novoUtensilio" placeholder="Novo utensílio">
                        <button class="btnAdicionar" type="button" onclick="addUtensilio()">Adicionar Utensílio</button>
                    </div>
                    <div>
                        <input type="text" id="novoPasso" placeholder="Novo passo">
                        <button class="btnAdicionar" type="button" onclick="addPasso()">Adicionar Passo</button>
                    </div>
                    <div>
                        <input type="file" id="fotoReceita" name="imagem" accept="image/*">
                       <!--  <button class="btnAdicionar" type="button" onclick="addPasso()">Adicionar Passo</button> -->
                    </div>
                </div>
                <br><br>

                


            </form>

               <!-- INGREDIENTES -->
                <div class="listas">
                   
                    <div class="listaUl">
                        <h3>Ingredientes</h3>

                    </div>
                    <ul id="listaIngredientes"></ul>

                <!-- UTENSÍLIOS -->

                    
                    <div class="listaUl">
                        <h3>Utensílios</h3>
                    </div>
                    <ul id="listaUtensilios"></ul>

                <!-- PASSOS DO PREPARO -->

                    
                    <div class="listaUl">
                        <h3>Preparo</h3>
                   </div>
                    <ul id="listaPassos"></ul>
                </div>


                <button class="cadastrar" onclick="cadastrar()">Cadastrar</button>
        </div>
        

    </main>
    <footer>
        <div>
            Copyright
        </div>
    </footer>

    <script>

        var listaCategoria = document.getElementById('seleCategoria');
        var listaCusto = document.getElementById('seleCusto');
        var listaDificuldade = document.getElementById('seleDificuldade');
        var listaCozinha = document.getElementById('seleCozinha');




        function carregarCategoria(){
            fetch("../Backend/buscar_categorias.php")
            .then(response => response.json())
            .then(dados => {

                for (let i = 0; i < dados.length; i++){
                    let option = document.createElement('option');
                    option.textContent = dados[i].categoria;
                    listaCategoria.appendChild(option);
                }

        })
        .catch(error => console.error("Erro:", error));

        }

        carregarCategoria();

        function carregarCozinha(){
            fetch("../Backend/buscar_cozinha.php")
            .then(response => response.json())
            .then(dados => {

                for (let i = 0; i < dados.length; i++){
                    let option = document.createElement('option');
                    option.textContent = dados[i].cozinha;
                    listaCozinha.appendChild(option);
                }

        })
        .catch(error => console.error("Erro:", error));

        }

        carregarCozinha();

        
        function carregarCusto(){
            fetch("../Backend/buscar_custos.php")
            .then(response => response.json())
            .then(dados => {

                for (let i = 0; i < dados.length; i++){
                    let option = document.createElement('option');
                    option.textContent = dados[i].custo;
                    listaCusto.appendChild(option);
                }

        })
        .catch(error => console.error("Erro:", error));

        }

        carregarCusto();

        
        function carregarDificuldade(){
            fetch("../Backend/buscar_dificuldades.php")
            .then(response => response.json())
            .then(dados => {

                for (let i = 0; i < dados.length; i++){
                    let option = document.createElement('option');
                    option.textContent = dados[i].dificuldade;
                    listaDificuldade.appendChild(option);
                }

        })
        .catch(error => console.error("Erro:", error));

        }

          
        carregarDificuldade();



        function addItem(inputId, ulId) {
            const texto = document.getElementById(inputId).value.trim();
            if (texto === "") return;

            const li = document.createElement("li");
            li.textContent = texto;

            // botão remover
            const btn = document.createElement("button");
            btn.className = 'btnX';
            btn.textContent = "X";
            btn.onclick = () => li.remove();

            li.appendChild(btn);
            document.getElementById(ulId).appendChild(li);

            document.getElementById(inputId).value = "";
        }

        function addIngrediente() { addItem("novoIngrediente", "listaIngredientes"); }
        function addUtensilio()   { addItem("novoUtensilio", "listaUtensilios"); }
        function addPasso()       { addItem("novoPasso", "listaPassos"); }

        function cadastrar() {

            function ulToText(ulId) {
                return [...document.querySelectorAll(`#${ulId} li`)]
                    .map(li => li.firstChild.textContent) // pega só o texto, sem o botão
                    .join("\n");
            }

            let seleCategoria = document.getElementById('seleCategoria');
            let seleDificuldade = document.getElementById('seleDificuldade');
            let seleCusto = document.getElementById('seleCusto');
            let seleCozinha = document.getElementById('seleCozinha');

            const categoriaSelect = seleCategoria.options[seleCategoria.selectedIndex].text;
            const difiSelect = seleDificuldade.options[seleDificuldade.selectedIndex].text;
            const custoSelect = seleCusto.options[seleCusto.selectedIndex].text;
            const coziSelect = seleCozinha.options[seleCozinha.selectedIndex].text;

            
            const dados = {
                    titulo: document.getElementById("titulo").value,
                    descricao: document.getElementById('descricao').value,
                    custo: custoSelect,
                    categoria: categoriaSelect,
                    dificuldade: difiSelect,
                    cozinha: coziSelect,
                    ingredientes: ulToText("listaIngredientes"),
                    utensilios: ulToText("listaUtensilios"),
                    preparo: ulToText("listaPassos")
            };
            
            if(dados.titulo.trim() === "" || dados.descricao.trim() === ""){
                alert("Preencha todos os campos!");
                return;
            }
           
            const qtdeIngredientes = document.querySelectorAll("#listaIngredientes li").length;
            const qtdeUtensilios = document.querySelectorAll("#listaUtensilios li").length;
            const qtdePassos = document.querySelectorAll("#listaPassos li").length;

            if(qtdeIngredientes === 0){
                alert("Insira pelo menos um ingrediente!");
                return;
            }

            if(qtdeUtensilios === 0){
                alert("Insira pelo menos um Utensílio!");
                return;
            }

            if(qtdePassos === 0){
                alert("Insira pelo menos um Passo de Preparo!");
                return;
            }

            const imagem = document.getElementById("fotoReceita").files[0];
            if (!imagem) {
                alert("Adicione uma imagem da receita!");
                return;
            }

            console.log("Dados enviados:", dados);

            const formData = new FormData();
            formData.append("imagem", imagem);
            formData.append("dados", JSON.stringify(dados));

            fetch("../Backend/cadastrar_receita.php", {
                method: "POST",
                body: formData
            })
            .then(res => res.text())
            .then(data => {
                alert(data);
            });


            alert("Receita Cadastrada!");

          

            //window.location.href = "../Frontend/listarReceitas.html";
        };
    </script>

</body>
</html>